flowchart LR
    %% list all the input files
    samplesheet>Samplesheet]
    genome_fasta>
        Genome
        FASTA
    ]
    annotations_gtf>
        Annotations
        GTF
    ]

    %% list all the internal Nextflow channels
    raw_reads[(
        Raw
        reads
    )]
    prealign_reads[(
        Prealign
        reads
    )]
    trim_log[(
        Trim
        log
    )]
    individual_alignments[(
        Individual
        alignments
    )]
    merged_alignments[(
        Merged
        alignments
    )]

    %% list all the Nextflow processes
    fastp{fastp}
    cutadapt{cutadapt}
    fastqc{FastQC}
    seq_depth{
        Sequencing
        Depth
    }
    bwa_mem2{bwa-mem2}
    STAR{STAR}
    samtools_sort{
        samtools
        sort
        index
    }
    gatk_MergeSamFiles{
        gatk
        MergeSamFiles
    }
    gatk_MarkDuplicates{
        gatk
        MarkDuplicates
    }
    samtools_idxstats{
        samtools
        idxstats
    }
    samtools_flagstat{
        samtools
        flagstat
    }
    samtools_stats{
        samtools
        stats
    }

    %% list all subgraphs for Nextflow subworkflows/workflows with options
    subgraph inputs["Input Files"]
    samplesheet
    genome_fasta
    annotations_gtf
    end
    subgraph trim_reads["Trim Reads"]
    fastp
    cutadapt
    end
    subgraph map_reads["Map Reads"]
    bwa_mem2
    STAR
    end
    subgraph publish_reports["Publish Reports"]
    reads_mqc
    alignments_mqc
    full_mqc
    end
    subgraph publish_data["Publish Data"]
    alignments
    end

    %% list all the published reports files
    reads_mqc(((
        Reads
        MultiQC
    )))
    alignments_mqc(((
        Alignments
        MultiQC
    )))
    full_mqc(((
        Full MultiQC
    )))

    %% list all the published data files
    alignments[[
        Alignments
    ]]

    %% reads processing workflow
    samplesheet --> raw_reads
    raw_reads --- trim_reads --> prealign_reads

    %% reads QC workflow
    raw_reads --- fastqc --x reads_mqc
    prealign_reads --- fastqc --x reads_mqc
    trim_reads --> trim_log --x reads_mqc
    raw_reads --- seq_depth --x reads_mqc
    prealign_reads --- seq_depth --x reads_mqc

    %% reads mapping workflow
    genome_fasta --- map_reads
    annotations_gtf --- map_reads
    prealign_reads --- map_reads

    %% alignments processing workflow
    map_reads --- samtools_sort --> individual_alignments
    individual_alignments --- gatk_MergeSamFiles --- gatk_MarkDuplicates --> merged_alignments
    merged_alignments --x alignments

    %% alignments QC workflow
    individual_alignments --- samtools_idxstats --x alignments_mqc
    individual_alignments --- samtools_flagstat --x alignments_mqc
    merged_alignments --- samtools_stats --x alignments_mqc

    %% Full MultiQC
    reads_mqc --x full_mqc
    alignments_mqc --x full_mqc